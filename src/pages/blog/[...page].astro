---
import Layout from "@/layout/Layout.astro";
import {existsSync,readdirSync} from 'fs';
import {resolve} from 'path';
import SvgPz from "@/components/panzoomsvg.astro"


const output_static = true;//import.meta.en.SSR is buggy always True : https://docs.astro.build/en/reference/api-reference/#importmeta

const {page} = Astro.params;
const page_path = resolve(process.cwd()+'/data/blog/'+page)
console.log(page_path)
if(!existsSync(page_path) && !output_static){
    console.log(`${page} does not exist`)
    //return Astro.redirect("/")
}
//Astro.glob()only use literals, no variables, no string litterals
const posts = await Astro.glob('../../../data/blog/**/*.{md,mdx}')//relative to this file

const Post = posts.find((post)=>(resolve(post.file) == page_path))
if((typeof Post == "undefined") && !output_static){
    console.log(`${page} could not be parsed by Astro.glob`)
    //return Astro.redirect("/")
}

export async function getStaticPaths(){
    const files = readdirSync('data/blog/')//relative to astro root
    return files.map((file)=>({params:{page:file}}))
}

---
{Post &&
<Layout title={Post.frontmatter.title} headings={Post.getHeadings()}>
        <Post.Content components={{ SvgPz,data:SvgPz }}/>
</Layout>
}
