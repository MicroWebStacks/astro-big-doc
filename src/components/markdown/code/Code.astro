---
import Highlighter from './Highlighter.astro'
import Plantuml from './Plantuml.astro'
import Kroki from './Kroki.astro'
import ModelViewerCode from '../model/ModelViewerCode.astro';
import Cards from '../cards/Cards.astro'
import Gallery from '../../gallery/gallery_grid.astro';
import Swiper from '../../swiper/swiper.astro'

export interface Props {
    node: object;
    dirpath: object;
}

const { node, dirpath } = Astro.props as Props;

const code = node.value
const language = node.lang
const params = node.meta?node.meta.split(' '):[]

const custom_languages = ["plantuml","mermaid","blockdiag"]

const yaml_glb      = ((language == "yaml") && (node.meta?.startsWith("glb")))
const yaml_cards    = ((language == "yaml") && (node.meta?.startsWith("cards")))
const yaml_gallery  = ((language == "yaml") && (node.meta?.startsWith("gallery")))
const yaml_swiper  = ((language == "yaml") && (node.meta?.startsWith("swiper")))
const custom_yaml = yaml_glb || yaml_cards || yaml_gallery || yaml_swiper

const other_language = (!custom_languages.includes(language) && !custom_yaml)
---
{(language == "plantuml")&&
    <Plantuml code={code} params={params} />
}
{(language == "blockdiag")&&
    <Kroki language={language} code={code} params={params} />
}
{(language == "mermaid")&&
    <Kroki language="mermaid" code={code} params={params} />
}
{yaml_glb &&
    <ModelViewerCode code={code} dirpath={dirpath}/>
}
{yaml_cards &&
    <Cards code={code} dirpath={dirpath}/>
}
{yaml_gallery &&
    <Gallery code={code} dirpath={dirpath}/>
}
{yaml_swiper &&
    <Swiper code={code} dirpath={dirpath}/>
}
{other_language&&
    <Highlighter code={code} language={language} params={params} />
}
